import java.awt.Color;
import java.awt.FlowLayout;
import java.awt.Font;
import java.awt.Image;
import java.awt.Toolkit;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.ArrayList;

import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.SwingUtilities;
import javax.swing.table.DefaultTableCellRenderer;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableColumnModel;

public class BloodBoard extends JFrame{
	
	private JTable table;//데이터 테이블
	private JScrollPane jScoll;//데이터 테이블이 들어가는 scroll
	private DefaultTableModel mod;
	private JLabel title;//타이틀 "헌혈증서사용상태"
	private JComboBox<String> comboStandard, comboStatus;//조회기준이 들어있는 콤보박스,신청상태가 들어있는 콤보박스
	private JTextField searchText;//검색 텍스트 필드
	private JButton search,delete,approve;//사용할 버튼들
	private String columnNames[]={ "증서번호", "사용자이름", "사용자이메일","신청상태" };
	private String rowData[][],rowDataTemp[][];//테이블에 들어갈 데이터들
	private CertificationList CertList;//헌혈증목록
	private JFrame frame;
	private String id;
	
	public BloodBoard(String id)
	{
		super("BLOOD_Board");
		setLocation(360, 225);//프레임위치 설정
		setSize(1200,730);// 프레임크기 설정
		setContentPane(new JLabel(new ImageIcon("icon\\pulse1.jpg")));
		setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);//close박스
		setLayout(null);//레이아웃 널값

		this.id=id;
		
		Toolkit tk=Toolkit.getDefaultToolkit();
		Image img= tk.getImage("icon\\frameicon.png");
		setIconImage(img);
		
		title = new JLabel("헌혈증서 사용신청 상태");//title넣기
		title.setBounds(85, 50, 280, 40);
		title.setFont(new Font("", 1, 25));
		add(title);
		
		SearchInfo();//테이블 내용 조회
		
        TableSet(rowData);//테이블 생성 및 설정
     
		ComboBoxSet();//콤보박스생성
		
		searchText = new JTextField();//search텍스트필트
		searchText.setBounds(645,50,200,40);
		searchText.setBackground(Color.WHITE);
		searchText.setFont(new Font("", 1, 15));
		add(searchText);
		
		KeyListener k = new KeyListener() {
			
			@Override
			public void keyTyped(KeyEvent e) {
				// TODO Auto-generated method stub
				
			}
			
			@Override
			public void keyReleased(KeyEvent e) {
				// TODO Auto-generated method stub
				
			}
			
			@Override
			public void keyPressed(KeyEvent e) {
				if(e.getKeyCode() == KeyEvent.VK_ENTER)
				{
					search.doClick();//검색 칸에서 ENTER 키 입력시 "search"버튼 클릭
				}
				
			}
		};
		searchText.addKeyListener(k);
		Handler h = new Handler();
		
		ButtonSet();//버튼생성
		search.addActionListener(h);
		delete.addActionListener(h);
		approve.addActionListener(h);
		
		setVisible(true);
	}
	private class Handler implements ActionListener
	{
		@Override
		public void actionPerformed(ActionEvent event)
		{
			if(event.getSource()==search)
			{
				if(searchText.getText().equals(""))//새로고침
				{
					SearchInfo();
					jscroll.setVisible(false);
					TableSet(rowData);
				}
				else//검색
				{
					SearchInfo(searchText.getText(),comboStandard.getSelectedIndex(),comboStatus.getSelectedIndex());
					jscroll.setVisible(false);
					TableSet(rowDataTemp);
				}
			}
		//	else if(event.getSource())
		//	{
				
		//	}
		}
	}
	public void SearchInfo()//rowdata불러오기 및 새로고침
	{
		try
		{
			File is = new File("C:\\Users\\june\\Desktop\\BloodLink\\Java\\SoftwareEngineering\\table.txt");
			BufferedReader bf = new BufferedReader(new FileReader(is));
			String row;
			ArrayList<String[]> rData=new ArrayList<String[]>();
			int i=0;
			
			while ((row = bf.readLine()) != null) 
			{	 
				i++;	   
			}
			bf.close();
			bf=new BufferedReader(new FileReader(is));
			
			rowData=new String[i][4];
			i=0;
			while ((row = bf.readLine()) != null) 
			{	 
				rowData[i++]=row.split(" ");   
			}
			return ;
		}
		catch(Exception e)
		{
			
		}
	}
	public void SearchInfo(String a,int index,int sindex)//rowdata불러오기 및 새로고침
	{
		try
		{
			File is = new File("C:\\Users\\june\\Desktop\\BloodLink\\Java\\SoftwareEngineering\\table.txt");
			BufferedReader bf = new BufferedReader(new FileReader(is));
			String row;
			ArrayList<String[]> rData=new ArrayList<String[]>();
			int i=0;
			int count=0;
			String status="";
			if(sindex==1)
				status="사용대기";
			else if(sindex==2)
				status="사용완료";
			
			while ((row = bf.readLine()) != null) 
			{	
				if(row.split(" ")[index].equals(a))
				{
					if(sindex!=0)
					{
						if(row.split(" ")[4].equals(status))
							count++;
					}
					else 
						count++;
				}
				i++;	   
			}
			bf.close();
			bf=new BufferedReader(new FileReader(is));
			rowDataTemp=new String[count][4];
			i=0;
			while ((row = bf.readLine()) != null) 
			{	
				if(row.split(" ")[index].equals(a))
				{
					if(sindex!=0)
					{
						if(row.split(" ")[4].equals(status))
							rowDataTemp[i++]=row.split(" ");   
					}
					else 
						rowDataTemp[i++]=row.split(" ");   
				}
			}
			return ;
		}
		catch(Exception e)
		{
			
		}
	}
	public void deleteInfo(String number)
	{
		
	}
	public void ButtonSet()//button들 생성
	{
		search = new JButton("조회");//search버튼
		search.setBounds(855,50,80,40);
		search.setFont(new Font("", 1, 15));
		
		delete = new JButton("삭제");//delete 버튼
		delete.setBounds(945,50,80,40);
		delete.setFont(new Font("", 1, 15));

		approve = new JButton("승인");//approve 버튼
		approve.setBounds(1035,50,80,40);
		approve.setFont(new Font("", 1, 15));
		add(delete);
		add(search);
		add(approve);
	}
	public void ComboBoxSet()//combobox생성
	{
		String status[] = {"신청상태(전체)","사용대기","사용완료"};
		comboStatus= new JComboBox<String>(status);//사용상태 콤보박스생성
		comboStatus.setBounds(385,50,130,40);
		comboStatus.setBackground(Color.WHITE);
		comboStatus.setFont(new Font("", 1, 15));
		
		String standard[]= {"증서번호", "사용자이름", "사용자이메일" };
		comboStandard = new JComboBox<String>(standard);//comboStandardbox생성
		comboStandard.setBounds(525, 50, 110, 40);
		comboStandard.setBackground(Color.WHITE);
		comboStandard.setFont(new Font("", 1, 15));
		add(comboStatus);
		add(comboStandard);
		return ;
	}
	public void TableSet(String Data[][])
	{
		mod= new DefaultTableModel(Data,columnNames) {
			public boolean isCellEditable(int row,int column)//table 임의로 수정불가
			{
				return false;
			}
		};
		table = new JTable(mod);//table생성
		table.setSelectionMode(2);//다중 선택가능
		TableWidth();//table 간격 조절
        table.setFont(new Font("", 1, 15));//table font 크기조절
        table.setRowHeight(40);
        TableFontSort();//글씨 가운데 정렬
        
        jscroll = new JScrollPane(table);//scroll 생성
		jscroll.setBounds(85, 120, 1030, 500);//크기설정
		jscroll.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);//수직방향스크롤
		add(jscroll);
		return ;
	}
	public void TableWidth()//테이블 열 간격조절
	{
		table.getColumn("증서번호").setPreferredWidth(5);
		table.getColumn("사용자이름").setPreferredWidth(20);
		table.getColumn("사용자이메일").setPreferredWidth(110);
		table.getColumn("신청상태").setPreferredWidth(10);
	}
	public void TableFontSort()//table 글씨 정렬
	{
		// DefaultTableCellHeaderRenderer 생성 (가운데 정렬을 위한)
		DefaultTableCellRenderer tScheduleCellRenderer = new DefaultTableCellRenderer();

				 
		// DefaultTableCellHeaderRenderer의 정렬을 가운데 정렬로 지정
		tScheduleCellRenderer.setHorizontalAlignment(SwingConstants.CENTER);
				
		// 정렬할 테이블의 ColumnModel을 가져옴
		TableColumnModel tcmSchedule = table.getColumnModel();

				 
		// 반복문을 이용하여 테이블을 가운데 정렬로 지정
		for (int i = 0; i < tcmSchedule.getColumnCount(); i++) {
		tcmSchedule.getColumn(i).setCellRenderer(tScheduleCellRenderer);
		}
	}
}
